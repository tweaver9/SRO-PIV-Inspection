<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PIV Catalog</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      margin: 0;
      background: black;
      font-family: Arial, sans-serif;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      flex-direction: column;
    }

    #container {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    input[type="number"] {
      width: 300px;
      font-size: 24px;
      padding: 10px;
      text-align: center;
    }

    button {
      margin: 15px;
      padding: 10px 20px;
      font-size: 18px;
    }

    #plus {
      position: absolute;
      top: 20px;
      right: 20px;
      background-color: green;
      color: white;
      border: none;
      padding: 10px;
    }
  </style>
</head>
<body>
  <button id="plus">ï¼‹</button>
  <div id="container">
    <input id="pivNumber" type="number" placeholder="Enter PIV number" />
    <button onclick="startEntry()">Enter</button>
    <button onclick="generatePDF()">Done</button>
  </div>

  <script>
    const entries = JSON.parse(localStorage.getItem("pivData") || "[]");

    const questions = [
      "Position of Valve",
      "Sight glass condition",
      "Placard properly aligned",
      "Is there damage or corrosion to the valve/body",
      "Is identification easily visible",
      "Is it chained with functioning lock",
      "Are there any leaks from the valve or body",
      "Is there a wrench available"
    ];

    const options = [
      ["Open", "Closed"],
      ["Good", "Needs Repair"],
      ["Yes", "No"],
      ["Yes", "No"],
      ["Yes", "No"],
      ["Yes", "No"],
      ["Yes", "No"],
      ["Yes", "No"]
    ];

    async function startEntry() {
      const num = document.getElementById("pivNumber").value;
      if (!num) return alert("Enter a PIV number first!");
      const piv = `PIV-${num}`;

      const issue = confirm("Does PIV have an issue?");
      if (!issue) {
        entries.push([piv, "Open", "Good", "Yes", "No", "Yes", "Yes", "No", "Yes", ""]);
        saveEntries();
        document.getElementById("pivNumber").value = "";
        return;
      }

      let answers = [piv];
      for (let i = 0; i < questions.length; i++) {
        const a = prompt(`${questions[i]}?\n(${options[i].join(" / ")})`);
        if (!a) return alert("Entry canceled.");
        answers.push(a);
      }
      answers.push(""); // comments column
      entries.push(answers);
      saveEntries();
      document.getElementById("pivNumber").value = "";
    }

    function saveEntries() {
      localStorage.setItem("pivData", JSON.stringify(entries));
    }

    function generatePDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ orientation: "landscape" });

      const header = [
        "PIV", "Position", "Sight", "Placard", "Corros.", "ID Vis", "Chain", "Leaks", "Wrench", "Comments"
      ];

      const colWidth = 25;
      const rowHeight = 10;
      const marginX = 10;
      const marginY = 20;
      const rowsPerPage = 20;

      let page = 0;

      for (let i = 0; i < entries.length; i++) {
        if (i % rowsPerPage === 0) {
          if (i !== 0) doc.addPage();
          header.forEach((text, col) => {
            doc.text(text, marginX + col * colWidth, marginY);
          });
        }

        const rowY = marginY + rowHeight * ((i % rowsPerPage) + 1);
        entries[i].forEach((val, col) => {
          doc.text(val, marginX + col * colWidth, rowY);
        });
      }

      doc.save("PIV_Entries.pdf");
    }

    document.getElementById("plus").addEventListener("click", () => {
      const piv = prompt("Enter PIV number:");
      if (piv) {
        const answerSet = [];
        for (let i = 0; i < questions.length; i++) {
          const ans = prompt(`${questions[i]}?\n(${options[i].join(" / ")})`);
          if (!ans) return;
          answerSet.push(ans);
        }
        entries.push([`PIV-${piv}`, ...answerSet, ""]);
        saveEntries();
      }
    });
  </script>
</body>
</html>